<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Manager - Simple Test</title>
    
    <!-- SAP UI5 - OpenUI5 CDN -->
    <script
        id="sap-ui-bootstrap"
        src="https://sdk.openui5.org/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m"
        data-sap-ui-compatVersion="edge"
        data-sap-ui-async="true">
    </script>

    <script>
        sap.ui.getCore().attachInit(function () {
            // Create a simple page with direct content
            var oPage = new sap.m.Page({
                title: "Feature Manager - Configuration",
                enableScrolling: true,
                content: [
                    new sap.m.MessageStrip({
                        text: "Loading features from API...",
                        type: "Information",
                        showIcon: true
                    })
                ]
            });
            
            // Load features from API
            fetch("/api/features")
                .then(response => response.json())
                .then(data => {
                    console.log("API Response:", data);
                    
                    if (data.success) {
                        // Handle nested structure
                        const featuresObj = data.features.features || data.features;
                        console.log("Features object:", featuresObj);
                        
                        // Clear page content
                        oPage.removeAllContent();
                        
                        // Add success message
                        oPage.addContent(new sap.m.MessageStrip({
                            text: `Loaded ${Object.keys(featuresObj).length} features successfully`,
                            type: "Success",
                            showIcon: true
                        }));
                        
                        // Create list of features
                        var oList = new sap.m.List({
                            headerText: "All Features",
                            mode: "None"
                        });
                        
                        // Add each feature to list
                        for (const [key, feature] of Object.entries(featuresObj)) {
                            console.log(`Adding feature: ${key}`, feature);
                            
                            var oListItem = new sap.m.CustomListItem({
                                content: [
                                    new sap.m.HBox({
                                        justifyContent: "SpaceBetween",
                                        alignItems: "Center",
                                        width: "100%",
                                        items: [
                                            new sap.m.VBox({
                                                items: [
                                                    new sap.m.Title({
                                                        text: feature.displayName || key,
                                                        level: "H5"
                                                    }),
                                                    new sap.m.Text({
                                                        text: feature.description || "No description"
                                                    }),
                                                    new sap.m.Label({
                                                        text: "Category: " + (feature.category || "Uncategorized")
                                                    })
                                                ]
                                            }),
                                            new sap.m.Switch({
                                                state: feature.enabled || false,
                                                customTextOn: "ON",
                                                customTextOff: "OFF",
                                                change: function(oEvent) {
                                                    var bState = oEvent.getParameter("state");
                                                    sap.m.MessageToast.show(key + " toggled to " + (bState ? "ON" : "OFF"));
                                                }
                                            })
                                        ]
                                    })
                                ]
                            });
                            
                            oList.addItem(oListItem);
                        }
                        
                        oPage.addContent(oList);
                    } else {
                        oPage.removeAllContent();
                        oPage.addContent(new sap.m.MessageStrip({
                            text: "Error: " + (data.error || "Unknown error"),
                            type: "Error",
                            showIcon: true
                        }));
                    }
                })
                .catch(error => {
                    console.error("Error loading features:", error);
                    oPage.removeAllContent();
                    oPage.addContent(new sap.m.MessageStrip({
                        text: "Error loading features: " + error.message,
                        type: "Error",
                        showIcon: true
                    }));
                });
            
            oPage.placeAt("content");
        });
    </script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #content {
            height: 100%;
        }
    </style>
</head>
<body class="sapUiBody" id="content">
    <!-- UI5 content will be rendered here -->
</body>
</html>