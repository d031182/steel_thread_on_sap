<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procure to Pay</title>
    
    <!-- SAP UI5 Bootstrap -->
    <script
        id="sap-ui-bootstrap"
        src="https://sdk.openui5.org/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m,sap.f"
        data-sap-ui-compatVersion="edge"
        data-sap-ui-async="true">
    </script>

    <!-- Import APIs -->
    <script src="../js/utils/clientErrorLogger.js"></script>

    <script type="module">
        import { LogViewerAPI } from '../js/api/logViewerAPI.js';
        import { debugLogger } from '../js/utils/debugLogger.js';

        const logViewerAPI = new LogViewerAPI();

        sap.ui.getCore().attachInit(async function() {
            "use strict";

            // Load feature flags
            let features = {};
            try {
                const response = await fetch("/api/features");
                const data = await response.json();
                if (data && data.success) {
                    features = data.features.features || data.features;
                }
            } catch (error) {
                console.warn("Could not load feature flags:", error);
            }

            // Create Application with ShellBar
            var oApp = new sap.m.App({
                pages: [
                    new sap.m.Page({
                        showHeader: false,
                        content: [
                            // SAP Fiori ShellBar (Application Shell)
                            new sap.f.ShellBar({
                                title: "Procure to Pay",
                                showNavButton: false,
                                showCopilot: false,
                                showSearch: false,
                                showNotifications: false,
                                profile: new sap.f.Avatar({
                                    initials: "UI"
                                })
                            }),
                            
                            // Toolbar with action buttons (below ShellBar)
                            new sap.m.Toolbar({
                                content: [
                                    new sap.m.ToolbarSpacer(),
                                    new sap.m.Button({
                                        icon: "sap-icon://refresh",
                                        text: "Load Data",
                                        press: function() {
                                            loadDataProducts();
                                        }
                                    }),
                                    new sap.m.Button({
                                        icon: "sap-icon://database",
                                        text: "Data Sources",
                                        press: function() {
                                            openSourceConfiguratorDialog();
                                        }
                                    }),
                                    new sap.m.Button({
                                        icon: "sap-icon://notes",
                                        text: "Logging",
                                        press: function() {
                                            openLoggingDialog();
                                        }
                                    }),
                                    new sap.m.Button({
                                        icon: "sap-icon://action-settings",
                                        text: "Settings",
                                        press: function() {
                                            openSettingsDialog();
                                        }
                                    })
                                ]
                            }),
                            
                            // Main content area with data products tiles
                            new sap.m.VBox({
                                id: "mainContent",
                                items: [
                                    new sap.m.Title({
                                        text: "Data Products",
                                        level: "H2"
                                    }),
                                    new sap.m.Text({
                                        id: "loadingStatus",
                                        text: "Click 'Load Data' button above to view data products"
                                    }).addStyleClass("sapUiSmallMarginTop"),
                                    // TileContainer will be added here dynamically
                                    new sap.m.FlexBox({
                                        id: "tilesContainer",
                                        wrap: "Wrap",
                                        justifyContent: "Start",
                                        alignItems: "Start"
                                    }).addStyleClass("sapUiSmallMarginTop")
                                ]
                            }).addStyleClass("sapUiContentPadding sapUiLargeMarginTop")
                        ]
                    })
                ]
            });

            // Open Logging Dialog
            async function openLoggingDialog() {
                sap.ui.core.BusyIndicator.show(0);
                
                try {
                    // Fetch logs from API
                    const result = await logViewerAPI.getLogs({ limit: 100 });
                    
                    if (!result.success) {
                        throw new Error(result.error?.message || "Failed to load logs");
                    }
                    
                    const logs = result.logs || [];
                    
                    // Calculate statistics
                    const stats = {
                        total: logs.length,
                        INFO: logs.filter(l => l.level === 'INFO').length,
                        WARNING: logs.filter(l => l.level === 'WARNING').length,
                        ERROR: logs.filter(l => l.level === 'ERROR').length
                    };
                    
                    // Check current debug mode state
                    const debugMode = localStorage.getItem('debugMode') === 'true';
                    
                    // Create log viewer dialog
                    const oLogDialog = new sap.m.Dialog({
                        title: "Application Logs",
                        contentWidth: "80%",
                        contentHeight: "70%",
                        resizable: true,
                        draggable: true,
                        content: [
                            new sap.m.VBox({
                                items: [
                                    // Debug Mode Toggle
                                    new sap.m.Toolbar({
                                        content: [
                                            new sap.m.Label({ 
                                                text: "Debug Mode:",
                                                design: "Bold"
                                            }),
                                            new sap.m.Switch({
                                                state: debugMode,
                                                customTextOn: "ON",
                                                customTextOff: "OFF",
                                                change: function(oEvent) {
                                                    const bState = oEvent.getParameter("state");
                                                    if (bState) {
                                                        localStorage.setItem('debugMode', 'true');
                                                        console.log("[Debug Mode] Enabled");
                                                    } else {
                                                        localStorage.removeItem('debugMode');
                                                        console.log("[Debug Mode] Disabled");
                                                    }
                                                    sap.m.MessageToast.show("Debug Mode " + (bState ? "enabled" : "disabled") + " - Refresh page to apply");
                                                }
                                            }).addStyleClass("sapUiTinyMarginBegin"),
                                            new sap.m.ToolbarSpacer(),
                                            new sap.m.Text({
                                                text: "Enable for detailed browser console logging"
                                            })
                                        ]
                                    }).addStyleClass("sapUiTinyMarginBottom"),
                                    
                                    // Toolbar with filters
                                    new sap.m.OverflowToolbar({
                                        content: [
                                            new sap.m.Title({
                                                text: "Logs (" + logs.length + ")",
                                                level: "H2"
                                            }),
                                            new sap.m.ToolbarSpacer(),
                                            new sap.m.Label({ text: "Filter:" }),
                                            new sap.m.SegmentedButton({
                                                selectedKey: "ALL",
                                                selectionChange: async function(oEvent) {
                                                    const level = oEvent.getParameter("item").getKey();
                                                    await refreshLogs(oLogDialog, level);
                                                },
                                                items: [
                                                    new sap.m.SegmentedButtonItem({
                                                        key: "ALL",
                                                        text: "All (" + stats.total + ")"
                                                    }),
                                                    new sap.m.SegmentedButtonItem({
                                                        key: "INFO",
                                                        text: "Info (" + stats.INFO + ")"
                                                    }),
                                                    new sap.m.SegmentedButtonItem({
                                                        key: "WARNING",
                                                        text: "Warning (" + stats.WARNING + ")"
                                                    }),
                                                    new sap.m.SegmentedButtonItem({
                                                        key: "ERROR",
                                                        text: "Error (" + stats.ERROR + ")"
                                                    })
                                                ]
                                            }),
                                            new sap.m.Button({
                                                icon: "sap-icon://refresh",
                                                tooltip: "Refresh",
                                                press: async function() {
                                                    await refreshLogs(oLogDialog, "ALL");
                                                }
                                            })
                                        ]
                                    }),
                                    
                                    // Logs table
                                    new sap.m.Table({
                                        id: "logsTable",
                                        growing: true,
                                        growingThreshold: 50,
                                        columns: [
                                            new sap.m.Column({
                                                header: new sap.m.Label({ text: "Time" }),
                                                width: "160px"
                                            }),
                                            new sap.m.Column({
                                                header: new sap.m.Label({ text: "Level" }),
                                                width: "100px",
                                                hAlign: "Center"
                                            }),
                                            new sap.m.Column({
                                                header: new sap.m.Label({ text: "Message" })
                                            })
                                        ],
                                        items: logs.map(function(log) {
                                            let state = "None";
                                            let icon = "sap-icon://message-information";
                                            
                                            if (log.level === "ERROR") {
                                                state = "Error";
                                                icon = "sap-icon://message-error";
                                            } else if (log.level === "WARNING") {
                                                state = "Warning";
                                                icon = "sap-icon://message-warning";
                                            } else if (log.level === "INFO") {
                                                state = "Information";
                                                icon = "sap-icon://message-information";
                                            }
                                            
                                            return new sap.m.ColumnListItem({
                                                cells: [
                                                    new sap.m.Text({
                                                        text: logViewerAPI.formatTimestamp(log.timestamp)
                                                    }),
                                                    new sap.m.ObjectStatus({
                                                        text: log.level,
                                                        state: state,
                                                        icon: icon
                                                    }),
                                                    new sap.m.Text({
                                                        text: log.message,
                                                        wrapping: true
                                                    })
                                                ]
                                            });
                                        })
                                    })
                                ]
                            })
                        ],
                        beginButton: new sap.m.Button({
                            text: "Close",
                            press: function() {
                                oLogDialog.close();
                            }
                        }),
                        afterClose: function() {
                            oLogDialog.destroy();
                        }
                    });
                    
                    oLogDialog.open();
                    
                } catch (error) {
                    sap.m.MessageBox.error("Error loading logs: " + error.message);
                } finally {
                    sap.ui.core.BusyIndicator.hide();
                }
            }

            // Refresh logs
            async function refreshLogs(oDialog, level) {
                sap.ui.core.BusyIndicator.show(0);
                
                try {
                    const fetchLevel = (level === 'ALL') ? null : level;
                    const result = await logViewerAPI.getLogs({ level: fetchLevel, limit: 100 });
                    
                    if (!result.success) {
                        throw new Error(result.error?.message || "Failed to refresh logs");
                    }
                    
                    const logs = result.logs || [];
                    
                    // Update table
                    const oTable = sap.ui.getCore().byId("logsTable");
                    if (oTable) {
                        oTable.destroyItems();
                        
                        logs.forEach(function(log) {
                            let state = "None";
                            let icon = "sap-icon://message-information";
                            
                            if (log.level === "ERROR") {
                                state = "Error";
                                icon = "sap-icon://message-error";
                            } else if (log.level === "WARNING") {
                                state = "Warning";
                                icon = "sap-icon://message-warning";
                            } else if (log.level === "INFO") {
                                state = "Information";
                                icon = "sap-icon://message-information";
                            }
                            
                            oTable.addItem(new sap.m.ColumnListItem({
                                cells: [
                                    new sap.m.Text({
                                        text: logViewerAPI.formatTimestamp(log.timestamp)
                                    }),
                                    new sap.m.ObjectStatus({
                                        text: log.level,
                                        state: state,
                                        icon: icon
                                    }),
                                    new sap.m.Text({
                                        text: log.message,
                                        wrapping: true
                                    })
                                ]
                            }));
                        });
                    }
                    
                    sap.m.MessageToast.show("Logs refreshed (" + logs.length + " entries)");
                    
                } catch (error) {
                    sap.m.MessageBox.error("Error refreshing logs: " + error.message);
                } finally {
                    sap.ui.core.BusyIndicator.hide();
                }
            }

            // Open Settings Dialog
            async function openSettingsDialog() {
                sap.ui.core.BusyIndicator.show(0);
                
                try {
                    // Fetch features from API
                    const response = await fetch("/api/features");
                    const data = await response.json();
                    
                    if (!data || !data.success) {
                        throw new Error(data?.error || "Failed to load features");
                    }
                    
                    const featuresObj = data.features.features || data.features;
                    
                    // Create list of features
                    const oList = new sap.m.List({
                        headerText: "Application Features",
                        mode: "None"
                    });
                    
                    for (const [key, feature] of Object.entries(featuresObj)) {
                        const oSwitch = new sap.m.Switch({
                            state: feature.enabled || false,
                            customTextOn: "ON",
                            customTextOff: "OFF",
                            change: async function(oEvent) {
                                const bState = oEvent.getParameter("state");
                                await toggleFeature(key, feature.displayName, bState, oSwitch);
                            }
                        });
                        
                        const oItem = new sap.m.InputListItem({
                            label: feature.displayName || key,
                            content: [oSwitch]
                        });
                        
                        if (feature.description) {
                            oItem.setTooltip(feature.description);
                        }
                        
                        oList.addItem(oItem);
                    }
                    
                    // Create settings dialog
                    const oSettingsDialog = new sap.m.Dialog({
                        title: "Settings",
                        contentWidth: "600px",
                        contentHeight: "500px",
                        resizable: true,
                        draggable: true,
                        content: [
                            new sap.m.VBox({
                                items: [
                                    new sap.m.MessageStrip({
                                        text: "Enable or disable features. Changes take effect immediately.",
                                        type: "Information",
                                        showIcon: true
                                    }).addStyleClass("sapUiTinyMarginBottom"),
                                    oList
                                ]
                            })
                        ],
                        beginButton: new sap.m.Button({
                            text: "Close",
                            press: function() {
                                oSettingsDialog.close();
                            }
                        }),
                        afterClose: function() {
                            oSettingsDialog.destroy();
                        }
                    });
                    
                    oSettingsDialog.open();
                    
                } catch (error) {
                    sap.m.MessageBox.error("Error loading settings: " + error.message);
                } finally {
                    sap.ui.core.BusyIndicator.hide();
                }
            }

            // Toggle feature
            async function toggleFeature(key, name, state, oSwitch) {
                oSwitch.setBusy(true);
                
                try {
                    const response = await fetch(`/api/features/${key}/toggle`, {
                        method: "POST"
                    });
                    const data = await response.json();
                    
                    if (data && data.success) {
                        sap.m.MessageToast.show(`${name} ${data.enabled ? "enabled" : "disabled"}`);
                    } else {
                        sap.m.MessageToast.show(`Failed to toggle ${name}`);
                        oSwitch.setState(!state);
                    }
                } catch (error) {
                    sap.m.MessageToast.show(`Error: ${error.message}`);
                    oSwitch.setState(!state);
                } finally {
                    oSwitch.setBusy(false);
                }
            }

            // Open Source Configurator Dialog
            async function openSourceConfiguratorDialog() {
                // Predefined connections
                const connections = [
                    {
                        id: "hana",
                        name: "HANA Cloud",
                        type: "SAP HANA Cloud",
                        host: "your-instance.hanacloud.ondemand.com",
                        port: 443,
                        status: "Connected",
                        isPredefined: true
                    },
                    {
                        id: "sqlite",
                        name: "Local SQLite",
                        type: "SQLite Database",
                        host: "localhost",
                        port: null,
                        status: "Connected",
                        isPredefined: true
                    }
                ];
                
                // Create list of connections
                const oList = new sap.m.List({
                    headerText: "Data Source Connections",
                    mode: "None",
                    items: connections.map(function(conn) {
                        let icon = "sap-icon://database";
                        let statusState = "Success";
                        
                        if (conn.type === "SAP HANA Cloud") {
                            icon = "sap-icon://cloud";
                            statusState = "Success";
                        } else if (conn.type === "SQLite Database") {
                            icon = "sap-icon://database";
                            statusState = "Success";
                        }
                        
                        return new sap.m.StandardListItem({
                            title: conn.name,
                            description: conn.type + " â€¢ " + conn.host + (conn.port ? ":" + conn.port : ""),
                            icon: icon,
                            info: conn.status,
                            infoState: statusState,
                            type: "Active",
                            press: function() {
                                editConnection(conn);
                            }
                        });
                    })
                });
                
                // Create source configurator dialog
                const oSourceDialog = new sap.m.Dialog({
                    title: "Data Source Configurator",
                    contentWidth: "700px",
                    contentHeight: "500px",
                    resizable: true,
                    draggable: true,
                    content: [
                        new sap.m.VBox({
                            items: [
                                new sap.m.MessageStrip({
                                    text: "Manage data source connections. Two predefined sources are available: HANA Cloud and Local SQLite.",
                                    type: "Information",
                                    showIcon: true
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                oList,
                                
                                new sap.m.Toolbar({
                                    content: [
                                        new sap.m.ToolbarSpacer(),
                                        new sap.m.Button({
                                            text: "Add Connection",
                                            icon: "sap-icon://add",
                                            type: "Emphasized",
                                            press: function() {
                                                addNewConnection();
                                            }
                                        })
                                    ]
                                }).addStyleClass("sapUiTinyMarginTop")
                            ]
                        })
                    ],
                    beginButton: new sap.m.Button({
                        text: "Close",
                        press: function() {
                            oSourceDialog.close();
                        }
                    }),
                    afterClose: function() {
                        oSourceDialog.destroy();
                    }
                });
                
                oSourceDialog.open();
            }
            
            // Edit connection
            function editConnection(conn) {
                const oEditDialog = new sap.m.Dialog({
                    title: "Connection Details: " + conn.name,
                    contentWidth: "500px",
                    content: [
                        new sap.m.VBox({
                            items: [
                                new sap.m.Label({ text: "Connection Name:" }),
                                new sap.m.Input({
                                    value: conn.name,
                                    editable: !conn.isPredefined
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Type:" }),
                                new sap.m.Input({
                                    value: conn.type,
                                    editable: false
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Host:" }),
                                new sap.m.Input({
                                    value: conn.host,
                                    editable: !conn.isPredefined
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Port:" }),
                                new sap.m.Input({
                                    value: conn.port ? String(conn.port) : "N/A",
                                    editable: !conn.isPredefined
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Status:" }),
                                new sap.m.ObjectStatus({
                                    text: conn.status,
                                    state: conn.status === "Connected" ? "Success" : "Error"
                                }),
                                
                                new sap.m.MessageStrip({
                                    text: conn.isPredefined ? 
                                        "This is a predefined connection and cannot be modified." :
                                        "You can modify this custom connection.",
                                    type: conn.isPredefined ? "Information" : "Success",
                                    showIcon: true
                                }).addStyleClass("sapUiSmallMarginTop")
                            ]
                        }).addStyleClass("sapUiSmallMargin")
                    ],
                    beginButton: new sap.m.Button({
                        text: conn.isPredefined ? "Close" : "Save",
                        press: function() {
                            if (!conn.isPredefined) {
                                sap.m.MessageToast.show("Connection saved (feature coming soon)");
                            }
                            oEditDialog.close();
                        }
                    }),
                    endButton: new sap.m.Button({
                        text: "Test Connection",
                        press: function() {
                            sap.m.MessageToast.show("Testing connection to " + conn.name + "...");
                            setTimeout(function() {
                                sap.m.MessageBox.success("Connection successful!");
                            }, 1000);
                        }
                    }),
                    afterClose: function() {
                        oEditDialog.destroy();
                    }
                });
                
                oEditDialog.open();
            }
            
            // Add new connection
            function addNewConnection() {
                const oAddDialog = new sap.m.Dialog({
                    title: "Add New Connection",
                    contentWidth: "500px",
                    content: [
                        new sap.m.VBox({
                            items: [
                                new sap.m.Label({ text: "Connection Name:" }),
                                new sap.m.Input({
                                    placeholder: "My Connection"
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Type:" }),
                                new sap.m.Select({
                                    items: [
                                        new sap.ui.core.Item({ key: "hana", text: "SAP HANA Cloud" }),
                                        new sap.ui.core.Item({ key: "sqlite", text: "SQLite Database" }),
                                        new sap.ui.core.Item({ key: "postgres", text: "PostgreSQL" }),
                                        new sap.ui.core.Item({ key: "mysql", text: "MySQL" })
                                    ]
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Host:" }),
                                new sap.m.Input({
                                    placeholder: "hostname or IP"
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Port:" }),
                                new sap.m.Input({
                                    placeholder: "443",
                                    type: "Number"
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Username:" }),
                                new sap.m.Input({
                                    placeholder: "username"
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Password:" }),
                                new sap.m.Input({
                                    type: "Password",
                                    placeholder: "password"
                                }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.MessageStrip({
                                    text: "Custom connections will be stored locally and encrypted.",
                                    type: "Information",
                                    showIcon: true
                                }).addStyleClass("sapUiSmallMarginTop")
                            ]
                        }).addStyleClass("sapUiSmallMargin")
                    ],
                    beginButton: new sap.m.Button({
                        text: "Add",
                        type: "Emphasized",
                        press: function() {
                            sap.m.MessageToast.show("Adding connection... (feature coming soon)");
                            oAddDialog.close();
                        }
                    }),
                    endButton: new sap.m.Button({
                        text: "Cancel",
                        press: function() {
                            oAddDialog.close();
                        }
                    }),
                    afterClose: function() {
                        oAddDialog.destroy();
                    }
                });
                
                oAddDialog.open();
            }

            // Load Data Products
            async function loadDataProducts() {
                const tilesContainer = sap.ui.getCore().byId("tilesContainer");
                const loadingText = sap.ui.getCore().byId("loadingStatus");
                
                if (!tilesContainer || !loadingText) {
                    console.error("Required UI elements not found");
                    return;
                }
                
                loadingText.setText("Loading data products from SQLite...");
                
                try {
                    // Load from SQLite (default)
                    const response = await fetch("/api/data-products?source=sqlite");
                    const data = await response.json();
                    
                    if (!data.success) {
                        throw new Error(data.error || "Failed to load data products");
                    }
                    
                    const dataProducts = data.data_products || [];
                    
                    // Update loading text
                    loadingText.setText(`Found ${dataProducts.length} data products from SQLite`);
                    
                    // Clear tiles
                    tilesContainer.destroyItems();
                    
                    // Create tiles for each data product
                    dataProducts.forEach(function(dp) {
                        const tile = new sap.m.GenericTile({
                            header: dp.display_name || dp.name,
                            subheader: dp.version || "v1",
                            frameType: "TwoByOne",
                            press: function() {
                                showDataProductDetails(dp);
                            },
                            tileContent: [
                                new sap.m.TileContent({
                                    content: [
                                        new sap.m.NumericContent({
                                            value: dp.entity_count || 0,
                                            valueColor: "Good",
                                            icon: "sap-icon://database"
                                        })
                                    ]
                                })
                            ]
                        });
                        
                        tile.addStyleClass("sapUiTinyMargin");
                        tilesContainer.addItem(tile);
                    });
                    
                    if (dataProducts.length === 0) {
                        loadingText.setText("No data products found in SQLite database");
                    }
                    
                } catch (error) {
                    console.error("Error loading data products:", error);
                    loadingText.setText("Error loading data products: " + error.message);
                    sap.m.MessageToast.show("Failed to load data products");
                }
            }
            
            // Show data product details
            function showDataProductDetails(dp) {
                const oDetailsDialog = new sap.m.Dialog({
                    title: dp.display_name || dp.name,
                    contentWidth: "600px",
                    content: [
                        new sap.m.VBox({
                            items: [
                                new sap.m.Label({ text: "Name:" }),
                                new sap.m.Text({ text: dp.name }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Display Name:" }),
                                new sap.m.Text({ text: dp.display_name || "N/A" }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Version:" }),
                                new sap.m.Text({ text: dp.version || "N/A" }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Entities:" }),
                                new sap.m.Text({ text: String(dp.entity_count || 0) }).addStyleClass("sapUiTinyMarginBottom"),
                                
                                new sap.m.Label({ text: "Source:" }),
                                new sap.m.ObjectStatus({
                                    text: "SQLite Database",
                                    state: "Success",
                                    icon: "sap-icon://database"
                                })
                            ]
                        }).addStyleClass("sapUiSmallMargin")
                    ],
                    beginButton: new sap.m.Button({
                        text: "View Details",
                        type: "Emphasized",
                        press: function() {
                            sap.m.MessageToast.show("View details for " + dp.name + " (feature coming soon)");
                        }
                    }),
                    endButton: new sap.m.Button({
                        text: "Close",
                        press: function() {
                            oDetailsDialog.close();
                        }
                    }),
                    afterClose: function() {
                        oDetailsDialog.destroy();
                    }
                });
                
                oDetailsDialog.open();
            }

            // Load data products on page load
            loadDataProducts();

            // Render
            oApp.placeAt("content");
        });
    </script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        #content {
            height: 100%;
        }
    </style>
</head>
<body class="sapUiBody" id="content">
</body>
</html>