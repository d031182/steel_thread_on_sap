<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage P2P Data Products - SAP Fiori</title>
    
    <style>
        /* Enhanced Fiori Horizon styling to match p2p-data-products-fiori-compliant.html */
        
        /* Shell-like header */
        .sapFDynamicPageTitle {
            background-color: #354a5f !important;
            color: white !important;
            padding: 0.75rem 1rem !important;
        }
        
        .sapFDynamicPageTitle .sapMTitle {
            color: white !important;
            font-size: 1.125rem !important;
            font-weight: 400 !important;
        }
        
        /* Page header info strip */
        .sapFDynamicPageHeader {
            background-color: #ffffff !important;
            border-bottom: 1px solid #e5e5e5;
        }
        
        /* Better card styling */
        .sapMGT {
            border: 1px solid #e5e5e5 !important;
            box-shadow: 0 0 0.125rem 0 rgba(0,0,0,0.1) !important;
            transition: box-shadow 0.2s !important;
        }
        
        .sapMGT:hover {
            box-shadow: 0 0 0.5rem 0 rgba(0,0,0,0.1) !important;
        }
        
        /* Table improvements */
        .sapMListTblRow:hover {
            background-color: rgba(0, 112, 242, 0.03) !important;
        }
        
        .sapMListTblHeaderCell {
            background-color: #f5f6f7 !important;
            font-weight: 700 !important;
            font-size: 0.75rem !important;
            text-transform: uppercase !important;
        }
        
        /* Icon tab bar */
        .sapMITBHead {
            border-bottom: 2px solid #e5e5e5 !important;
        }
        
        .sapMITBFilter {
            font-size: 0.875rem !important;
        }
        
        .sapMITBFilterActive {
            border-bottom: 3px solid #0070f2 !important;
        }
        
        /* Object Status badges */
        .sapMObjectStatus {
            padding: 0.25rem 0.75rem !important;
            border-radius: 0.25rem !important;
            font-size: 0.75rem !important;
            font-weight: 700 !important;
        }
        
        /* Message strips */
        .sapMMessageStrip {
            border-left: 4px solid !important;
            border-radius: 0.25rem !important;
        }
        
        /* Footer toolbar */
        .sapMTB {
            border-top: 1px solid #e5e5e5 !important;
            background-color: #f5f6f7 !important;
        }
        
        /* Page background */
        body.sapUiBody {
            background-color: #f5f6f7 !important;
        }
        
        /* Content areas */
        .sapFDynamicPageContentWrapper {
            background-color: #ffffff !important;
        }
        
        /* Feature cards padding */
        .sapUiContentPadding .sapMFlexBox {
            background-color: #ffffff !important;
            border: 1px solid #e5e5e5 !important;
            border-radius: 0.25rem !important;
        }
        
        /* Dialog improvements */
        .sapMDialog {
            border-radius: 0.25rem !important;
        }
        
        .sapMDialogTitle {
            font-size: 1.125rem !important;
            font-weight: 700 !important;
        }
    </style>
    
    <!-- SAP UI5 Bootstrap -->
    <script
        id="sap-ui-bootstrap"
        src="https://sapui5.hana.ondemand.com/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m,sap.f,sap.ui.layout"
        data-sap-ui-compatVersion="edge"
        data-sap-ui-async="true"
        data-sap-ui-resourceroots='{
            "p2p.viewer": "./"
        }'>
    </script>
    
    <script>
        sap.ui.getCore().attachInit(function() {
            "use strict";
            
            sap.ui.require([
                "sap/m/App",
                "sap/f/DynamicPage",
                "sap/f/DynamicPageTitle",
                "sap/f/DynamicPageHeader",
                "sap/m/IconTabBar",
                "sap/m/IconTabFilter",
                "sap/m/VBox",
                "sap/m/HBox",
                "sap/m/Text",
                "sap/m/Title",
                "sap/m/Label",
                "sap/m/ObjectStatus",
                "sap/m/MessageStrip",
                "sap/m/Table",
                "sap/m/Column",
                "sap/m/ColumnListItem",
                "sap/m/GenericTile",
                "sap/m/TileContent",
                "sap/m/NumericContent",
                "sap/m/Button",
                "sap/m/OverflowToolbar",
                "sap/m/ToolbarSpacer",
                "sap/ui/layout/cssgrid/CSSGrid",
                "sap/ui/core/HTML"
            ], function(
                App, DynamicPage, DynamicPageTitle, DynamicPageHeader,
                IconTabBar, IconTabFilter, VBox, HBox,
                Text, Title, Label, ObjectStatus, MessageStrip,
                Table, Column, ColumnListItem, GenericTile, TileContent, NumericContent,
                Button, OverflowToolbar, ToolbarSpacer,
                CSSGrid, HTML
            ) {
                
                // Create Overview Tab Content
                function createOverviewTab() {
                    var messageStrip = new MessageStrip({
                        text: "This is a static HTML viewer. To query the actual database, use SQLite command line or a database tool.",
                        type: "Information",
                        showIcon: true
                    }).addStyleClass("sapUiSmallMarginBottom");
                    
                    // Statistics Tiles
                    var tileContainer = new CSSGrid({
                        gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
                        gridGap: "0.5rem",
                        items: [
                            new GenericTile({
                                header: "Database Tables",
                                subheader: "Data storage",
                                press: function() { oIconTabBar.setSelectedKey("database"); },
                                tileContent: new TileContent({
                                    content: new NumericContent({
                                        value: "22",
                                        valueColor: "Good",
                                        scale: "Tables"
                                    })
                                })
                            }),
                            new GenericTile({
                                header: "Views",
                                subheader: "Pre-built queries",
                                press: function() { oIconTabBar.setSelectedKey("database"); },
                                tileContent: new TileContent({
                                    content: new NumericContent({
                                        value: "8",
                                        valueColor: "Good",
                                        scale: "Views"
                                    })
                                })
                            }),
                            new GenericTile({
                                header: "Data Products",
                                subheader: "Collection containers",
                                press: function() { oIconTabBar.setSelectedKey("csn"); },
                                tileContent: new TileContent({
                                    content: new NumericContent({
                                        value: "6",
                                        valueColor: "Good",
                                        scale: "Files"
                                    })
                                })
                            }),
                            new GenericTile({
                                header: "Workflow Steps",
                                subheader: "P2P process",
                                press: function() { oIconTabBar.setSelectedKey("workflow"); },
                                tileContent: new TileContent({
                                    content: new NumericContent({
                                        value: "7",
                                        valueColor: "Good",
                                        scale: "Steps"
                                    })
                                })
                            })
                        ]
                    }).addStyleClass("sapUiSmallMarginTop");
                    
                    // Key Features
                    var featuresTitle = new Title({
                        text: "Key Features",
                        level: "H2"
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var featuresGrid = new CSSGrid({
                        gridTemplateColumns: "repeat(auto-fit, minmax(300px, 1fr))",
                        gridGap: "0.5rem",
                        items: [
                            createFeatureCard("Three-Way Matching", "Automated matching between Purchase Order, Goods Receipt/Service Entry, and Invoice with variance detection"),
                            createFeatureCard("Variance Detection", "Automatic detection of price, quantity, and date variances with blocking capabilities"),
                            createFeatureCard("Payment Management", "Payment terms with cash discounts, payment runs, and multiple payment methods"),
                            createFeatureCard("Multi-Currency", "Support for multiple currencies (USD, EUR, SGD) with exchange rate tracking"),
                            createFeatureCard("Service Procurement", "Complete Service Entry Sheet workflow with acceptance process"),
                            createFeatureCard("Audit Trail", "Complete tracking of who created/posted documents and when")
                        ]
                    }).addStyleClass("sapUiSmallMarginTop");
                    
                    return new VBox({
                        items: [
                            new Title({ text: "Project Overview", level: "H2" }),
                            messageStrip,
                            tileContainer,
                            featuresTitle,
                            featuresGrid
                        ]
                    }).addStyleClass("sapUiContentPadding");
                }
                
                function createFeatureCard(title, description) {
                    return new VBox({
                        items: [
                            new Title({ text: title, level: "H4" }),
                            new Text({ text: description }).addStyleClass("sapUiTinyMarginTop")
                        ]
                    }).addStyleClass("sapUiContentPadding").addStyleClass("sapUiResponsiveMargin");
                }
                
                // Create Database Tab Content
                function createDatabaseTab() {
                    var masterDataTable = new Table({
                        headerText: "Master Data Tables (9)",
                        columns: [
                            new Column({ header: new Label({ text: "Table Name" }) }),
                            new Column({ header: new Label({ text: "Description" }) }),
                            new Column({ header: new Label({ text: "Key Fields" }) })
                        ],
                        items: [
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "Suppliers" }),
                                    new Text({ text: "Vendor master data with contact, financial, and banking info" }),
                                    new Text({ text: "SupplierID, SupplierName, PaymentTermsCode" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "PaymentTerms" }),
                                    new Text({ text: "Payment terms with discount structures" }),
                                    new Text({ text: "PaymentTermsCode, NetPaymentDays, CashDiscount1Percent" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "CompanyCodes" }),
                                    new Text({ text: "Legal entities" }),
                                    new Text({ text: "CompanyCode, CompanyName, Currency" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "Plants" }),
                                    new Text({ text: "Physical locations/delivery addresses" }),
                                    new Text({ text: "PlantID, PlantName, CompanyCode" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "CostCenters" }),
                                    new Text({ text: "Cost accounting objects" }),
                                    new Text({ text: "CostCenter, CostCenterName, CompanyCode" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "Materials" }),
                                    new Text({ text: "Product master data" }),
                                    new Text({ text: "MaterialID, MaterialDescription, MaterialType" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "Services" }),
                                    new Text({ text: "Service master data" }),
                                    new Text({ text: "ServiceID, ServiceDescription, ServiceCategory" })
                                ]
                            })
                        ]
                    });
                    
                    var poTable = new Table({
                        headerText: "Purchase Order Tables (3)",
                        columns: [
                            new Column({ header: new Label({ text: "Table Name" }) }),
                            new Column({ header: new Label({ text: "Description" }) }),
                            new Column({ header: new Label({ text: "Key Fields" }) })
                        ],
                        items: [
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "PurchaseOrders" }),
                                    new Text({ text: "PO header information" }),
                                    new Text({ text: "PurchaseOrderID, SupplierID, TotalGrossAmount" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "PurchaseOrderItems" }),
                                    new Text({ text: "PO line items" }),
                                    new Text({ text: "PurchaseOrderID, ItemNumber, MaterialID/ServiceID" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "PurchaseOrderHistory" }),
                                    new Text({ text: "Document flow tracking" }),
                                    new Text({ text: "PurchaseOrderID, ItemNumber, TransactionType" })
                                ]
                            })
                        ]
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var jeTable = new Table({
                        headerText: "Journal Entry Tables (2)",
                        columns: [
                            new Column({ header: new Label({ text: "Table Name" }) }),
                            new Column({ header: new Label({ text: "Description" }) }),
                            new Column({ header: new Label({ text: "Key Fields" }) })
                        ],
                        items: [
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "JournalEntries" }),
                                    new Text({ text: "Accounting document header (FI postings)" }),
                                    new Text({ text: "CompanyCode, FiscalYear, AccountingDocument" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "JournalEntryItems" }),
                                    new Text({ text: "GL account line items with debit/credit" }),
                                    new Text({ text: "AccountingDocument, Item, GLAccount, Amount" })
                                ]
                            })
                        ]
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var viewsTable = new Table({
                        headerText: "Pre-built Views (8)",
                        columns: [
                            new Column({ header: new Label({ text: "View Name" }) }),
                            new Column({ header: new Label({ text: "Purpose" }) })
                        ],
                        items: [
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_CompleteP2PTracking" }),
                                    new Text({ text: "End-to-end tracking from PO to Payment" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_OutstandingInvoices" }),
                                    new Text({ text: "All unpaid invoices with days overdue" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_InvoiceVariances" }),
                                    new Text({ text: "Invoices with price/quantity variances" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_SupplierPerformance" }),
                                    new Text({ text: "Supplier metrics and KPIs" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_ServiceEntrySheetStatus" }),
                                    new Text({ text: "Service entry sheet tracking" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_PurchaseOrderStatus" }),
                                    new Text({ text: "Purchase order summary with quantities" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_PaymentTermsUsage" }),
                                    new Text({ text: "Payment terms utilization statistics" })
                                ]
                            }),
                            new ColumnListItem({
                                cells: [
                                    new Text({ text: "vw_FinancialPostings" }),
                                    new Text({ text: "Journal entries with source document tracking" })
                                ]
                            })
                        ]
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    return new VBox({
                        items: [
                            new Title({ text: "Database Schema", level: "H2" }),
                            masterDataTable,
                            poTable,
                            jeTable,
                            viewsTable
                        ]
                    }).addStyleClass("sapUiContentPadding");
                }
                
                // Data Product to Tables Mapping
                var dataProductMapping = {
                    "Supplier": {
                        tables: ["Suppliers"],
                        sampleData: [
                            { SupplierID: "SUP-001", SupplierName: "Global Steel Supply Inc", SupplierType: "Material", Country: "US", Currency: "USD", IsActive: 1 },
                            { SupplierID: "SUP-002", SupplierName: "Premium Electronics GmbH", SupplierType: "Material", Country: "DE", Currency: "EUR", IsActive: 1 },
                            { SupplierID: "SUP-005", SupplierName: "Industrial Maintenance Services", SupplierType: "Service", Country: "US", Currency: "USD", IsActive: 1 }
                        ]
                    },
                    "Purchase Order": {
                        tables: ["PurchaseOrders", "PurchaseOrderItems", "PurchaseOrderHistory"],
                        sampleData: [
                            { PurchaseOrderID: "PO-2024001", SupplierID: "SUP-001", DocumentDate: "2024-01-10", PurchaseOrderType: "Standard", Currency: "USD", TotalGrossAmount: 5250.00, POStatus: "FULLY_RECEIVED" },
                            { PurchaseOrderID: "PO-2024002", SupplierID: "SUP-005", DocumentDate: "2024-01-15", PurchaseOrderType: "Service", Currency: "USD", TotalGrossAmount: 10500.00, POStatus: "OPEN" },
                            { PurchaseOrderID: "PO-2024003", SupplierID: "SUP-002", DocumentDate: "2024-01-20", PurchaseOrderType: "Standard", Currency: "EUR", TotalGrossAmount: 15488.00, POStatus: "PARTIALLY_RECEIVED" }
                        ]
                    },
                    "Service Entry Sheet": {
                        tables: ["ServiceEntrySheets", "ServiceEntrySheetItems"],
                        sampleData: [
                            { ServiceEntrySheetID: "SES-2024001", PurchaseOrderID: "PO-2024002", DocumentDate: "2024-02-20", AcceptanceStatus: "ACCEPTED", DocumentStatus: "POSTED", Currency: "USD", TotalNetAmount: 5000.00 },
                            { ServiceEntrySheetID: "SES-2024002", PurchaseOrderID: "PO-2024004", DocumentDate: "2024-03-18", AcceptanceStatus: "ACCEPTED", DocumentStatus: "POSTED", Currency: "USD", TotalNetAmount: 2550.00 }
                        ]
                    },
                    "Supplier Invoice": {
                        tables: ["SupplierInvoices", "SupplierInvoiceItems"],
                        sampleData: [
                            { InvoiceID: "INV-2024001", SupplierInvoiceNumber: "GSS-2024-0156", SupplierID: "SUP-001", InvoiceDate: "2024-02-18", GrossAmount: 5250.00, Currency: "USD", InvoiceStatus: "PAID", PaymentStatus: "FULLY_PAID" },
                            { InvoiceID: "INV-2024002", SupplierInvoiceNumber: "IMS-2024-089", SupplierID: "SUP-005", InvoiceDate: "2024-02-22", GrossAmount: 5250.00, Currency: "USD", InvoiceStatus: "POSTED", PaymentStatus: "UNPAID" },
                            { InvoiceID: "INV-2024003", SupplierInvoiceNumber: "PE-2024-445", SupplierID: "SUP-002", InvoiceDate: "2024-03-05", GrossAmount: 15488.00, Currency: "EUR", InvoiceStatus: "HELD", PaymentStatus: "UNPAID" }
                        ]
                    },
                    "Payment Terms": {
                        tables: ["PaymentTerms"],
                        sampleData: [
                            { PaymentTermsCode: "NET30", PaymentTermsName: "Net 30 Days", NetPaymentDays: 30, CashDiscount1Days: null, CashDiscount1Percent: null, IsActive: 1 },
                            { PaymentTermsCode: "2/10NET30", PaymentTermsName: "2% 10 Days Net 30", NetPaymentDays: 30, CashDiscount1Days: 10, CashDiscount1Percent: 2.0, IsActive: 1 },
                            { PaymentTermsCode: "NET60", PaymentTermsName: "Net 60 Days", NetPaymentDays: 60, CashDiscount1Days: null, CashDiscount1Percent: null, IsActive: 1 }
                        ]
                    },
                    "Journal Entry Header": {
                        tables: ["JournalEntries", "JournalEntryItems"],
                        sampleData: [
                            { CompanyCode: "1000", FiscalYear: "2024", AccountingDocument: "5000000001", AccountingDocumentType: "KR", PostingDate: "2024-02-20", DocumentReferenceID: "INV-2024001", TransactionCurrency: "USD" },
                            { CompanyCode: "1000", FiscalYear: "2024", AccountingDocument: "5000000002", AccountingDocumentType: "KZ", PostingDate: "2024-03-20", DocumentReferenceID: "PAY-2024001", TransactionCurrency: "USD" },
                            { CompanyCode: "2000", FiscalYear: "2024", AccountingDocument: "5000000004", AccountingDocumentType: "KR", PostingDate: "2024-03-08", DocumentReferenceID: "INV-2024003", TransactionCurrency: "EUR" }
                        ]
                    }
                };
                
                // Create CSN Tab Content
                function createCSNTab() {
                    var intro = new Text({
                        text: "Data Products are collection containers consisting of one or more artefacts. Each product includes CSN schema definitions and supporting metadata within the same business context. Click on a card to view details."
                    }).addStyleClass("sapUiSmallMarginBottom");
                    
                    var csnGrid = new CSSGrid({
                        gridTemplateColumns: "repeat(auto-fit, minmax(300px, 1fr))",
                        gridGap: "0.5rem",
                        items: [
                            createCSNCard("Supplier", "sap-s4com-Supplier-v1.en.json", "Vendor master data definition including contact information, banking details, and payment terms", "Master Data", dataProductMapping),
                            createCSNCard("Purchase Order", "sap-s4com-PurchaseOrder-v1.en.json", "Purchase order header and item definitions with supplier confirmation tracking", "Transaction", dataProductMapping),
                            createCSNCard("Service Entry Sheet", "sap-s4com-ServiceEntrySheet-v1.en.json", "Service confirmation documents with acceptance workflow", "Transaction", dataProductMapping),
                            createCSNCard("Supplier Invoice", "sap-s4com-SupplierInvoice-v1.en.json", "Invoice header and item definitions with variance tracking and payment status", "Transaction", dataProductMapping),
                            createCSNCard("Payment Terms", "sap-s4com-PaymentTerms-v1.en.json", "Payment terms master data with discount structures", "Master Data", dataProductMapping),
                            createCSNCard("Journal Entry Header", "sap-s4com-JournalEntryHeader-v1.en.json", "Financial accounting documents with GL postings for invoice posting and payment clearing", "Transaction", dataProductMapping)
                        ]
                    }).addStyleClass("sapUiSmallMarginTop");
                    
                    var structureTitle = new Title({
                        text: "CSN File Structure",
                        level: "H3"
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var structureHTML = new HTML({
                        content: '<pre style="background: #f5f7fa; padding: 20px; border-radius: 8px; font-family: monospace; line-height: 1.8;">' +
                            'CSN File\n' +
                            '├── definitions\n' +
                            '│   ├── Entity 1\n' +
                            '│   │   ├── @EndUserText.label: {i18n reference}\n' +
                            '│   │   └── elements\n' +
                            '│   │       ├── Field 1: String, Number, Date, etc.\n' +
                            '│   │       ├── Field 2: Type, Length, Key\n' +
                            '│   │       └── Field N...\n' +
                            '│   └── Entity N...\n' +
                            '└── i18n\n' +
                            '    └── en (English translations)\n' +
                            '        ├── KEY1: "Label in English"\n' +
                            '        ├── KEY2: "Description in English"\n' +
                            '        └── KEYN...\n' +
                            '</pre>'
                    });
                    
                    var noteStrip = new MessageStrip({
                        text: "Original Files: The original multi-language CSN files contained dozens of languages. The English-only versions keep only the 'en' section, significantly reducing file size while maintaining complete entity definitions.",
                        type: "Warning",
                        showIcon: true
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    return new VBox({
                        items: [
                            new Title({ text: "Data Products", level: "H2" }),
                            intro,
                            csnGrid,
                            structureTitle,
                            structureHTML,
                            noteStrip
                        ]
                    }).addStyleClass("sapUiContentPadding");
                }
                
                function createCSNCard(title, filename, description, badge, mapping) {
                    var tile = new GenericTile({
                        header: title,
                        subheader: badge,
                        press: function() {
                            showDataProductDetail(title, mapping[title]);
                        },
                        tileContent: new TileContent({
                            content: new VBox({
                                items: [
                                    new Text({
                                        text: description,
                                        wrapping: true,
                                        maxLines: 3
                                    }).addStyleClass("sapUiTinyMarginTop"),
                                    new Text({
                                        text: "File: " + filename,
                                        wrapping: false
                                    }).addStyleClass("sapUiTinyMarginTop")
                                ]
                            })
                        })
                    });
                    
                    return tile;
                }
                
                // Show Data Product Detail in Dialog
                function showDataProductDetail(productName, productData) {
                    sap.ui.require(["sap/m/Dialog", "sap/m/Button"], function(Dialog, Button) {
                        if (!productData) return;
                        
                        var columns = productData.sampleData.length > 0 ? 
                            Object.keys(productData.sampleData[0]).map(function(key) {
                                return new Column({
                                    header: new Label({ text: key })
                                });
                            }) : [];
                        
                        var items = productData.sampleData.map(function(row) {
                            var cells = Object.keys(row).map(function(key) {
                                return new Text({ text: String(row[key]) });
                            });
                            return new ColumnListItem({ cells: cells });
                        });
                        
                        var sampleDataTable = new Table({
                            headerText: "Sample Data (" + productData.sampleData.length + " records)",
                            columns: columns,
                            items: items
                        }).addStyleClass("sapUiSmallMarginTop");
                        
                        var tablesText = new Text({
                            text: "This data product contains " + productData.tables.length + " table(s): " + productData.tables.join(", ")
                        }).addStyleClass("sapUiSmallMarginBottom");
                        
                        var dialog = new Dialog({
                            title: productName + " - Data Product Details",
                            contentWidth: "80%",
                            contentHeight: "70%",
                            resizable: true,
                            draggable: true,
                            content: [
                                new VBox({
                                    items: [
                                        new Title({ text: "Tables", level: "H3" }),
                                        tablesText,
                                        new Title({ text: "Sample Data Preview", level: "H3" }).addStyleClass("sapUiMediumMarginTop"),
                                        sampleDataTable
                                    ]
                                }).addStyleClass("sapUiContentPadding")
                            ],
                            beginButton: new Button({
                                text: "Close",
                                press: function() {
                                    dialog.close();
                                }
                            }),
                            afterClose: function() {
                                dialog.destroy();
                            }
                        });
                        
                        dialog.open();
                    });
                }
                
                // Create Workflow Tab - with proper padding
                function createWorkflowTab() {
                    var workflowHTML = new HTML({
                        content: '<div style="text-align: center; padding: 30px; font-family: monospace; line-height: 2;">' +
                            '<div style="background: linear-gradient(135deg, #0a6ed1 0%, #0854a0 100%); color: white; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 10px; font-weight: bold;">1. SUPPLIER<br/>Master Data</div>' +
                            '<div style="font-size: 2em; color: #0a6ed1; margin: 0 20px;">↓</div>' +
                            '<div style="background: linear-gradient(135deg, #0a6ed1 0%, #0854a0 100%); color: white; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 10px; font-weight: bold;">2. PURCHASE ORDER<br/>Create PO</div>' +
                            '<div style="margin-top: 10px; color: #666;">← Payment Terms</div>' +
                            '<div style="font-size: 2em; color: #0a6ed1; margin: 0 20px;">↓</div>' +
                            '<div style="display: inline-block;"><div style="background: linear-gradient(135deg, #0a6ed1 0%, #0854a0 100%); color: white; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 10px; font-weight: bold;">3a. GOODS RECEIPT<br/>Material Received</div></div>' +
                            '<span style="font-size: 2em; color: #0a6ed1; margin: 0 30px;">OR</span>' +
                            '<div style="display: inline-block;"><div style="background: linear-gradient(135deg, #0a6ed1 0%, #0854a0 100%); color: white; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 10px; font-weight: bold;">3b. SERVICE ENTRY<br/>Service Performed</div></div>' +
                            '<div style="font-size: 2em; color: #0a6ed1; margin: 0 20px;">↓</div>' +
                            '<div style="background: linear-gradient(135deg, #0a6ed1 0%, #0854a0 100%); color: white; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 10px; font-weight: bold;">4. SUPPLIER INVOICE<br/>Three-Way Match</div>' +
                            '<div style="margin-top: 10px; color: #666;">Variance Detection</div>' +
                            '<div style="font-size: 2em; color: #0a6ed1; margin: 0 20px;">↓</div>' +
                            '<div style="background: linear-gradient(135deg, #0a6ed1 0%, #0854a0 100%); color: white; padding: 15px 30px; border-radius: 8px; display: inline-block; margin: 10px; font-weight: bold;">5. PAYMENT<br/>Execute Payment</div>' +
                            '<div style="margin-top: 10px; color: #666;">Cash Discount Available</div>' +
                            '</div>'
                    });
                    
                    var scenariosTitle = new Title({
                        text: "Process Scenarios",
                        level: "H3"
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var scenario1 = createScenarioPanel(
                        "Scenario 1: Material Procurement",
                        "Standard flow for purchasing materials:",
                        [
                            "Create Purchase Order for materials",
                            "Receive goods → Create Goods Receipt",
                            "Supplier sends invoice",
                            "System performs three-way match (PO, GR, Invoice)",
                            "Post invoice if no variances",
                            "Execute payment per payment terms"
                        ]
                    );
                    
                    var scenario2 = createScenarioPanel(
                        "Scenario 2: Service Procurement",
                        "Flow for purchasing services:",
                        [
                            "Create Purchase Order for services",
                            "Service is performed",
                            "Create Service Entry Sheet → Manager acceptance",
                            "Supplier sends invoice",
                            "System performs three-way match (PO, SES, Invoice)",
                            "Post invoice and execute payment"
                        ]
                    );
                    
                    var scenario3 = createScenarioPanel(
                        "Scenario 3: Variance Handling",
                        "When invoice differs from PO/GR:",
                        [
                            "Invoice received with different price/quantity",
                            "System detects variance automatically",
                            "Invoice blocked with status = HELD",
                            "AP team reviews variance reason",
                            "Either: Reject invoice OR Approve variance",
                            "If approved: Release block and process payment"
                        ]
                    );
                    
                    return new VBox({
                        items: [
                            new Title({ text: "Procure-to-Pay Workflow", level: "H2" }),
                            new Title({ text: "Complete P2P Process Flow", level: "H3" }).addStyleClass("sapUiSmallMarginTop"),
                            workflowHTML,
                            scenariosTitle,
                            scenario1,
                            scenario2,
                            scenario3
                        ]
                    }).addStyleClass("sapUiContentPadding");
                }
                
                function createScenarioPanel(title, description, steps) {
                    var stepsList = steps.map(function(step, index) {
                        return (index + 1) + ". " + step;
                    }).join("\n");
                    
                    return new VBox({
                        items: [
                            new Title({ text: title, level: "H4" }),
                            new Text({ text: description }).addStyleClass("sapUiTinyMarginTop"),
                            new HTML({ content: '<pre style="color: #666; line-height: 2; margin-top: 10px;">' + stepsList + '</pre>' })
                        ]
                    }).addStyleClass("sapUiContentPadding").addStyleClass("sapUiResponsiveMargin");
                }
                
                // Create Queries Tab Content
                function createQueriesTab() {
                    var messageStrip = new MessageStrip({
                        text: "How to use: Copy these queries and run them in SQLite or your preferred database tool.",
                        type: "Information",
                        showIcon: true
                    }).addStyleClass("sapUiSmallMarginBottom");
                    
                    var queries = [
                        {
                            title: "1. Complete P2P Cycle for a Specific PO",
                            description: "View the entire document flow from PO to Payment",
                            sql: "SELECT * FROM vw_CompleteP2PTracking \nWHERE PurchaseOrderID = 'PO-2024001';"
                        },
                        {
                            title: "2. Outstanding Invoices",
                            description: "Find all unpaid invoices with overdue tracking",
                            sql: "SELECT * FROM vw_OutstandingInvoices\nORDER BY PaymentDueDate;"
                        },
                        {
                            title: "3. Invoices with Variances",
                            description: "Find blocked invoices with price/quantity mismatches",
                            sql: "SELECT * FROM vw_InvoiceVariances\nWHERE BlockingReason IS NOT NULL\nORDER BY InvoiceDate DESC;"
                        },
                        {
                            title: "4. Supplier Performance Report",
                            description: "Analyze supplier metrics and KPIs",
                            sql: "SELECT * FROM vw_SupplierPerformance\nORDER BY TotalInvoiceAmount DESC;"
                        },
                        {
                            title: "5. Cash Discount Opportunities",
                            description: "Find invoices eligible for early payment discounts",
                            sql: "SELECT \n  si.InvoiceID,\n  s.SupplierName,\n  si.GrossAmount,\n  si.CashDiscount1Amount,\n  CAST(julianday(si.CashDiscount1Date) - julianday('now') AS INTEGER) AS DaysRemaining\nFROM SupplierInvoices si\nJOIN Suppliers s ON si.SupplierID = s.SupplierID\nWHERE si.PaymentStatus = 'UNPAID'\n  AND si.CashDiscount1Date >= date('now')\nORDER BY DaysRemaining;"
                        },
                        {
                            title: "6. PO Items Not Yet Received",
                            description: "Track outstanding deliveries",
                            sql: "SELECT \n  poi.PurchaseOrderID,\n  poi.ItemNumber,\n  COALESCE(m.MaterialDescription, s.ServiceDescription) AS Item,\n  poi.OrderQuantity,\n  poi.QuantityReceived,\n  (poi.OrderQuantity - poi.QuantityReceived) AS Outstanding\nFROM PurchaseOrderItems poi\nLEFT JOIN Materials m ON poi.MaterialID = m.MaterialID\nLEFT JOIN Services s ON poi.ServiceID = s.ServiceID\nWHERE poi.QuantityReceived < poi.OrderQuantity;"
                        }
                    ];
                    
                    var queryPanels = queries.map(function(query) {
                        return createQueryPanel(query.title, query.description, query.sql);
                    });
                    
                    return new VBox({
                        items: [
                            new Title({ text: "Sample SQL Queries", level: "H2" }),
                            messageStrip
                        ].concat(queryPanels)
                    }).addStyleClass("sapUiContentPadding");
                }
                
                function createQueryPanel(title, description, sql) {
                    return new VBox({
                        items: [
                            new Title({ text: title, level: "H4" }),
                            new Text({ text: description }).addStyleClass("sapUiTinyMarginTop"),
                            new HTML({ 
                                content: '<pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 0.9em; overflow-x: auto; margin-top: 10px;">' + 
                                sql + 
                                '</pre>' 
                            })
                        ]
                    }).addStyleClass("sapUiContentPadding").addStyleClass("sapUiResponsiveMargin");
                }
                
                // Create Files Tab Content
                function createFilesTab() {
                    var dbGrid = new CSSGrid({
                        gridTemplateColumns: "repeat(auto-fit, minmax(400px, 1fr))",
                        gridGap: "0.5rem",
                        items: [
                            createFileCard("p2p_complete_workflow_sqlite.sql", "Complete P2P workflow database (SQLite)", ["22 Tables", "Sample Data", "8 Views"]),
                            createFileCard("p2p_supplier_invoice_sqlite.sql", "Simplified invoice-focused database", ["12 Tables", "Sample Data"])
                        ]
                    }).addStyleClass("sapUiSmallMarginTop");
                    
                    var csnTitle = new Title({
                        text: "CSN Model Files (English-Only)",
                        level: "H3"
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var csnGrid = new CSSGrid({
                        gridTemplateColumns: "repeat(auto-fit, minmax(400px, 1fr))",
                        gridGap: "0.5rem",
                        items: [
                            createFileCard("sap-s4com-Supplier-v1.en.json", "Supplier master data definition", ["~2.0 MB → Reduced"]),
                            createFileCard("sap-s4com-PurchaseOrder-v1.en.json", "Purchase order data definition", ["~4.7 MB → Reduced"]),
                            createFileCard("sap-s4com-ServiceEntrySheet-v1.en.json", "Service entry sheet definition", ["~816 KB → Reduced"]),
                            createFileCard("sap-s4com-SupplierInvoice-v1.en.json", "Supplier invoice definition", ["~967 KB → Reduced"]),
                            createFileCard("sap-s4com-PaymentTerms-v1.en.json", "Payment terms definition", ["~442 KB → Reduced"]),
                            createFileCard("sap-s4com-JournalEntryHeader-v1.en.json", "Journal entry header definition", ["~2.7 MB → 145 KB"])
                        ]
                    }).addStyleClass("sapUiSmallMarginTop");
                    
                    var docsTitle = new Title({
                        text: "Documentation Files",
                        level: "H3"
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var docsGrid = new CSSGrid({
                        gridTemplateColumns: "repeat(auto-fit, minmax(400px, 1fr))",
                        gridGap: "0.5rem",
                        items: [
                            createFileCard("P2P_COMPLETE_WORKFLOW_README.md", "Comprehensive database documentation with examples", []),
                            createFileCard("P2P_DATABASE_README.md", "Simplified database documentation", []),
                            createFileCard("SupplierInvoice-Extraction-Tracker.md", "Task tracker documenting all work completed", [])
                        ]
                    }).addStyleClass("sapUiSmallMarginTop");
                    
                    var quickStartTitle = new Title({
                        text: "Quick Start Commands",
                        level: "H3"
                    }).addStyleClass("sapUiMediumMarginTop");
                    
                    var commands = [
                        { title: "Create the Database", cmd: "sqlite3 p2p_complete.db < p2p_complete_workflow_sqlite.sql" },
                        { title: "Open Database and Query", cmd: "sqlite3 p2p_complete.db\n\nsqlite> SELECT * FROM vw_CompleteP2PTracking;" },
                        { title: "View Database Schema", cmd: "sqlite3 p2p_complete.db\n\nsqlite> .schema\nsqlite> .tables" }
                    ];
                    
                    var commandPanels = commands.map(function(cmd) {
                        return new VBox({
                            items: [
                                new Title({ text: cmd.title, level: "H4" }),
                                new HTML({ content: '<pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px; font-family: monospace; margin-top: 10px;">' + cmd.cmd + '</pre>' })
                            ]
                        }).addStyleClass("sapUiContentPadding").addStyleClass("sapUiSmallMarginTop");
                    });
                    
                    return new VBox({
                        items: [
                            new Title({ text: "Project Files", level: "H2" }),
                            new Title({ text: "Database Files", level: "H3" }).addStyleClass("sapUiSmallMarginTop"),
                            dbGrid,
                            csnTitle,
                            csnGrid,
                            docsTitle,
                            docsGrid,
                            quickStartTitle
                        ].concat(commandPanels)
                    }).addStyleClass("sapUiContentPadding");
                }
                
                function createFileCard(filename, description, badges) {
                    var badgeItems = badges.map(function(badge) {
                        return new ObjectStatus({ text: badge, state: "Success" });
                    });
                    
                    return new VBox({
                        items: [
                            new Title({ text: filename, level: "H4" }),
                            new Text({ text: description }).addStyleClass("sapUiSmallMarginTop")
                        ].concat(badgeItems.length > 0 ? [
                            new HBox({ items: badgeItems }).addStyleClass("sapUiSmallMarginTop")
                        ] : [])
                    }).addStyleClass("sapUiContentPadding").addStyleClass("sapUiResponsiveMargin");
                }
                
                // Create Icon Tab Bar with proper Fiori design
                var oIconTabBar = new IconTabBar({
                    expandable: false,
                    stretchContentHeight: true,
                    applyContentPadding: false,
                    items: [
                        new IconTabFilter({
                            key: "overview",
                            icon: "sap-icon://overview-chart",
                            text: "Overview",
                            content: createOverviewTab()
                        }),
                        new IconTabFilter({
                            key: "database",
                            icon: "sap-icon://database",
                            text: "Database",
                            content: createDatabaseTab()
                        }),
                        new IconTabFilter({
                            key: "csn",
                            icon: "sap-icon://document",
                            text: "Data Products",
                            content: createCSNTab()
                        }),
                        new IconTabFilter({
                            key: "workflow",
                            icon: "sap-icon://activity-2",
                            text: "Workflow",
                            content: createWorkflowTab()
                        }),
                        new IconTabFilter({
                            key: "queries",
                            icon: "sap-icon://search",
                            text: "Sample Queries",
                            content: createQueriesTab()
                        }),
                        new IconTabFilter({
                            key: "files",
                            icon: "sap-icon://folder",
                            text: "Files",
                            content: createFilesTab()
                        })
                    ]
                });
                
                // Create Dynamic Page with proper Fiori structure
                var oDynamicPage = new DynamicPage({
                    title: new DynamicPageTitle({
                        heading: new Title({ 
                            text: "Manage P2P Data Products",
                            level: "H1"
                        }),
                        actions: [
                            new Button({
                                text: "Refresh",
                                icon: "sap-icon://refresh",
                                press: function() {
                                    sap.m.MessageToast.show("Refreshed");
                                }
                            })
                        ]
                    }),
                    header: new DynamicPageHeader({
                        pinnable: true,
                        content: [
                            new MessageStrip({
                                text: "Procure-to-Pay Data Product Catalog and Database Schema",
                                type: "Information",
                                showIcon: true
                            })
                        ]
                    }),
                    content: [oIconTabBar],
                    footer: new OverflowToolbar({
                        content: [
                            new ToolbarSpacer(),
                            new ObjectStatus({
                                text: "SAP Fiori Compliant",
                                state: "Success",
                                icon: "sap-icon://accept"
                            }),
                            new Text({
                                text: " | Horizon Theme | Guidelines v1.142 | Updated: 2026-01-20"
                            }).addStyleClass("sapUiTinyMarginBegin")
                        ]
                    }).addStyleClass("sapUiTinyPadding"),
                    showFooter: true
                });
                
                // Create App
                var oApp = new App({
                    pages: [oDynamicPage]
                });
                
                // Place app in HTML
                oApp.placeAt("content");
            });
        });
    </script>
</head>
<body class="sapUiBody" id="content">
    <div id="busy" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <p>Loading SAP UI5 Application...</p>
    </div>
</body>
</html>
