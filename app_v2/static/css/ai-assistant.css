/**
 * AI Assistant Overlay Styling
 * =============================
 * 
 * Custom styling for AI Assistant dialog and messages
 * References: app_v2/static/css/css-variables.css
 */

@import url('css-variables.css');

/* ==================== Phase 4.1: Code Block Styling ==================== */

/* BEM Block: ai-message (Container for all AI message-related elements) */
/**
 * Block: .ai-message - Main container for AI message functionality
 * Purpose: Encapsulates all styling for AI message display and interaction
 * 
 * Elements (children):
 * - .ai-message__content - Message content wrapper
 * - .ai-message__list - Message list container
 * - .ai-message__input - Input field container
 * - .ai-message__button - Action buttons
 * - .ai-message__markdown - Markdown content
 */

/* Code block container for new overlay UI */
#ai-messages pre {
    margin: var(--spacing-md) 0;
    padding: 0;
    background: #f6f8fa;
    border-radius: var(--radius-lg);
    overflow: hidden;
}

#ai-messages pre code {
    display: block;
    padding: var(--spacing-lg);
    overflow-x: auto;
    font-family: var(--font-family-mono);
    font-size: var(--font-size-code);
    line-height: var(--line-height-tight);
}

/* Ensure code blocks have proper width in message bubbles */
#ai-messages pre {
    max-width: 100%;
}

/* Override white-space for code blocks (allow horizontal scroll) */
#ai-messages div[style*="white-space: pre-wrap"] pre {
    white-space: normal;
}

#ai-messages div[style*="white-space: pre-wrap"] pre code {
    white-space: pre;
}

/* ==================== Original Phase 1-3 Styling ==================== */

/* AI Assistant Button */
.aiAssistantButton {
    transition: transform var(--duration-fast) var(--easing-ease);
}

.aiAssistantButton:hover {
    transform: scale(1.1);
}

/* AI Message Styling */
.sapMFeedListItem[data-message-type="user"] {
    background-color: var(--color-user-bg);
    border-left: 3px solid var(--color-user-border);
    padding: var(--spacing-md);
    margin: var(--message-margin);
    border-radius: var(--radius-md);
}

.sapMFeedListItem[data-message-type="ai"] {
    background-color: var(--color-ai-bg);
    border-left: 3px solid var(--color-ai-border);
    padding: var(--spacing-md);
    margin: var(--message-margin);
    border-radius: var(--radius-md);
}

/* Code blocks in AI responses */
.sapMFeedListItem pre {
    background-color: var(--color-bg-code);
    color: var(--color-text-light);
    padding: var(--spacing-lg);
    border-radius: var(--radius-md);
    overflow-x: auto;
    font-family: var(--font-family-mono);
    font-size: var(--font-size-sm);
}

.sapMFeedListItem code {
    background-color: var(--color-bg-secondary);
    padding: var(--spacing-xs) 0.4rem;
    border-radius: var(--radius-sm);
    font-family: var(--font-family-mono);
    font-size: var(--font-size-sm);
}

/* Loading indicator in messages */
.sapMFeedListItem .sapMBusyIndicator {
    display: inline-block;
    margin-right: var(--spacing-sm);
}

/* Dialog specific styling */
#aiAssistantDialog .sapMDialog {
    box-shadow: var(--shadow-md);
}

/* Message list scrolling */
#aiMessageList {
    max-height: var(--message-list-max-height);
    overflow-y: auto;
}

/* Input area */
#aiMessageInput {
    font-size: var(--font-size-base);
}

/* Send button emphasis */
.sapMBtn[data-ai-send] {
    min-width: var(--button-min-width);
}

/* ==================== Phase 4.4: Message Bubble Text Color Fix (BEM Style) ==================== */

/* BEM Modifier: ai-message__content--light
 * Purpose: Ensure AI messages have readable dark text on light background
 */
#ai-messages div[style*="background: white"] {
    color: var(--color-text-primary) !important;
}

/* BEM Modifier: ai-message__content--user
 * Purpose: Ensure user messages keep white text on blue background
 */
#ai-messages div[style*="background: #0070f2"] {
    color: #ffffff !important;
}

/* BEM Modifier: ai-message__content--error
 * Purpose: Error messages keep white text on red background
 */
#ai-messages div[style*="background: #ff4444"] {
    color: var(--color-error-text) !important;
}

/* ==================== Phase 5: Sticky Input Field - SAP Fiori Compliant ==================== */

/**
 * SAP Fiori Dialog Layout Standard
 * =================================
 * 
 * Problem: Input field scrolls out of view when messages fill the dialog
 * Solution: Fiori-compliant layout with fixed footer and scrollable content
 * 
 * Standards Applied:
 * ✅ SAP Fiori Design Guidelines v1.96
 * ✅ SAPUI5 Dialog/ScrollContainer patterns
 * ✅ rem-based spacing via CSS variables
 * ✅ Responsive S/M/L sizes
 * ✅ Touch-optimized (44x44px minimum)
 */

/* Dialog content: Flexbox column layout (Fiori standard) */
.sapMDialog .sapMDialogScroll > .sapMVBox {
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
}

/* Messages scroll container: Flex-grow to fill space (Fiori scrollable content) */
.sapMDialog .sapMScrollCont {
    flex: 1 1 auto !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    padding: var(--spacing-lg) !important;
    scroll-behavior: smooth !important;
    transform: translateZ(0) !important;
    will-change: scroll-position !important;
}

/* Input toolbar: Fixed footer (Fiori standard) */
.sapMDialog .sapMToolbar {
    flex: 0 0 auto !important;
    border-top: 1px solid var(--color-border-primary) !important;
    background: var(--color-bg-primary) !important;
    padding: var(--toolbar-padding) !important;
    z-index: var(--z-toolbar) !important;
    box-shadow: var(--shadow-lg) !important;
}

/* Input field: Proper sizing with Fiori spacing */
.sapMDialog .sapMToolbar .sapMInputBase {
    flex: 1 1 auto !important;
    min-width: var(--input-min-width) !important;
    margin-right: var(--spacing-sm) !important;
}

/* Touch-friendly buttons: 44x44px minimum - Fiori touch target */
.sapMDialog .sapMToolbar .sapMBtn {
    min-width: var(--button-min-width) !important;
    min-height: var(--button-min-width) !important;
    margin-left: var(--spacing-xs) !important;
}

/* Emphasized button (Send): Fiori primary action */
.sapMDialog .sapMToolbar .sapMBtn.sapMBtnEmphasized {
    min-width: var(--touch-target-lg) !important;
}

/* Feed list: No extra margins that could cause layout issues */
.sapMDialog .sapMList {
    margin: 0 !important;
    padding: 0 !important;
}

/* Feed list items: Fiori spacing */
.sapMDialog .sapMFeedListItem {
    margin-bottom: var(--list-item-margin) !important;
}

/* Last feed item: No bottom margin */
.sapMDialog .sapMFeedListItem:last-child {
    margin-bottom: 0 !important;
}

/* Responsive: Size S (Smartphone) */
@media (max-width: 600px) {
    .sapMDialog .sapMToolbar {
        padding: var(--toolbar-padding-mobile) !important;
    }
    
    .sapMDialog .sapMScrollCont {
        padding: var(--spacing-md) !important;
    }
}

/* Responsive: Size M (Tablet) */
@media (min-width: 601px) and (max-width: 1024px) {
    .sapMDialog .sapMToolbar {
        padding: var(--toolbar-padding) !important;
    }
}

/* Responsive: Size L (Desktop) */
@media (min-width: 1025px) {
    .sapMDialog .sapMToolbar {
        padding: var(--spacing-lg) !important;
    }
}

/* ==================== Phase 6: Markdown Formatting (marked.js) - BEM Compliant ==================== */

/**
 * Element: .ai-message__content (Message content wrapper)
 * Purpose: Container for all message content including markdown
 * 
 * Modifiers:
 * - .ai-message__markdown - Markdown content styling
 * - .ai-message__markdown--bold - Bold text modifier
 * - .ai-message__markdown--italic - Italic text modifier
 * - .ai-message__markdown--code - Inline code modifier
 * - .ai-message__markdown--code-block - Code block modifier
 * - .ai-message__markdown--list - List modifier
 * - .ai-message__markdown--heading - Heading modifier
 * - .ai-message__markdown--link - Link modifier
 * - .ai-message__markdown--blockquote - Blockquote modifier
 * - .ai-message__markdown--table - Table modifier
 * - .ai-message__markdown--hr - Horizontal rule modifier
 */

/* Message content base styling */
.ai-message-content {
    line-height: var(--line-height-normal);
}

.ai-message-content > *:first-child {
    margin-top: 0;
}

.ai-message-content > *:last-child {
    margin-bottom: 0;
}

/* BEM Modifier: ai-message__markdown--bold */
.markdown-bold,
.ai-message-content strong {
    font-weight: 600;
    color: var(--color-text-primary);
}

/* BEM Modifier: ai-message__markdown--italic */
.markdown-italic,
.ai-message-content em {
    font-style: italic;
    color: var(--color-text-primary);
}

/* BEM Modifier: ai-message__markdown--code (inline code) */
.markdown-inline-code,
.ai-message-content code:not(pre code) {
    background-color: var(--color-bg-tertiary);
    border: 1px solid var(--color-border-secondary);
    border-radius: var(--radius-sm);
    padding: var(--spacing-xs) 0.4rem;
    font-family: var(--font-family-mono);
    font-size: var(--font-size-code);
    color: #bb0000;
}

/* BEM Modifier: ai-message__markdown--code-block */
.markdown-code-block,
.ai-message-content pre {
    background-color: var(--color-bg-tertiary);
    border: 1px solid var(--color-border-secondary);
    border-radius: var(--radius-md);
    padding: var(--spacing-sm);
    margin: var(--spacing-sm) 0;
    overflow-x: auto;
}

.ai-message-content pre code {
    font-family: var(--font-family-mono);
    font-size: var(--font-size-code);
    line-height: var(--line-height-tight);
    color: var(--color-text-primary);
    display: block;
    background: none;
    border: none;
    padding: 0;
}

/* BEM Modifier: ai-message__markdown--list */
.markdown-list,
.ai-message-content ul,
.ai-message-content ol {
    margin: var(--spacing-xs) 0;
    padding-left: 20px;
}

.markdown-list-item,
.ai-message-content li {
    margin: 2px 0;
    line-height: var(--line-height-tight);
}

/* Nested lists - even more compact */
.ai-message-content li ul,
.ai-message-content li ol {
    margin: 2px 0;
}

/* BEM Modifier: ai-message__markdown--heading */
.markdown-header,
.ai-message-content h1,
.ai-message-content h2,
.ai-message-content h3,
.ai-message-content h4,
.ai-message-content h5,
.ai-message-content h6 {
    font-weight: 600;
    margin: var(--spacing-sm) 0 var(--spacing-xs) 0;
    color: var(--color-text-primary);
}

/* First header in message - no top margin */
.ai-message-content h1:first-child,
.ai-message-content h2:first-child,
.ai-message-content h3:first-child,
.ai-message-content h4:first-child,
.ai-message-content h5:first-child,
.ai-message-content h6:first-child {
    margin-top: 0;
}

.markdown-h1, .ai-message-content h1 { font-size: 1.5em; }
.markdown-h2, .ai-message-content h2 { font-size: 1.3em; }
.markdown-h3, .ai-message-content h3 { font-size: 1.2em; }
.markdown-h4, .ai-message-content h4 { font-size: 1.1em; }
.markdown-h5, .ai-message-content h5 { font-size: 1em; }
.markdown-h6, .ai-message-content h6 { font-size: 0.9em; }

/* BEM Modifier: ai-message__markdown--link */
.markdown-link,
.ai-message-content a {
    color: var(--color-text-link);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--duration-fast) var(--easing-ease);
}

.markdown-link:hover,
.ai-message-content a:hover {
    border-bottom-color: var(--color-text-link);
}

/* BEM Modifier: ai-message__markdown--paragraph */
.markdown-paragraph,
.ai-message-content p {
    margin: var(--spacing-xs) 0;
    line-height: var(--line-height-tight);
}

/* First paragraph in message - no top margin */
.ai-message-content p:first-child {
    margin-top: 0;
}

/* Last paragraph in message - no bottom margin */
.ai-message-content p:last-child {
    margin-bottom: 0;
}

/* BEM Modifier: ai-message__markdown--blockquote */
.ai-message-content blockquote {
    margin: var(--spacing-md) 0;
    padding: var(--spacing-sm) var(--spacing-lg);
    border-left: 4px solid var(--color-border-secondary);
    background-color: var(--color-bg-tertiary);
    color: var(--color-text-primary);
}

/* BEM Modifier: ai-message__markdown--hr */
.ai-message-content hr {
    margin: var(--spacing-lg) 0;
    border: none;
    border-top: 1px solid var(--color-border-secondary);
}

/* BEM Modifier: ai-message__markdown--table */
.ai-message-content table {
    border-collapse: collapse;
    width: 100%;
    margin: var(--spacing-md) 0;
}

.ai-message-content th,
.ai-message-content td {
    border: 1px solid var(--color-border-secondary);
    padding: var(--spacing-sm);
    text-align: left;
}

.ai-message-content th {
    background-color: var(--color-bg-tertiary);
    font-weight: 600;
}
